<!doctype html>
<html lang="pt-BR">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pizzaria Rodrigues - Pedido Digital</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script><!-- Firebase SDK v9 -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        .category-card {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        
        .category-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .menu-item {
            transition: all 0.2s ease;
        }
        
        .menu-item:hover {
            background-color: rgba(139, 69, 19, 0.05);
        }
        
        .quantity-btn {
            transition: all 0.2s ease;
        }
        
        .quantity-btn:hover {
            transform: scale(1.1);
        }
        
        .cart-item {
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            animation: toastSlide 0.3s ease;
        }
        
        @keyframes toastSlide {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .shake {
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes bounce-in {
            0% { transform: scale(0.3) translateY(-50px); opacity: 0; }
            50% { transform: scale(1.05) translateY(0); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .animate-bounce-in {
            animation: bounce-in 0.6s ease-out;
        }

        .pulse-green {
            animation: pulse-green 2s infinite;
        }

        @keyframes pulse-green {
            0%, 100% { background-color: rgb(34, 197, 94); }
            50% { background-color: rgb(22, 163, 74); }
        }

        .connection-indicator {
            transition: all 0.3s ease;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="min-h-full">
  <div id="app" class="min-h-full bg-gradient-to-br from-orange-50 to-red-50"><!-- Header -->
   <header class="bg-white shadow-lg border-b-4 border-orange-500">
    <div class="max-w-6xl mx-auto px-4 py-6">
     <div class="text-center">
      <h1 id="pizzaria-title" class="text-4xl font-bold text-gray-800 mb-2">üçï Pizzaria Rodrigues</h1>
      <p id="welcome-message" class="text-lg text-gray-600">Bem-vindos ao sabor aut√™ntico da nossa cozinha!</p>
     </div>
    </div>
   </header>
   <div class="max-w-6xl mx-auto px-4 py-8">
    <div class="grid lg:grid-cols-3 gap-8"><!-- Menu Principal -->
     <div class="lg:col-span-2">
      <div class="bg-white rounded-xl shadow-lg p-6">
       <div class="flex justify-between items-center mb-6 border-b-2 border-orange-200 pb-3">
        <div>
         <h2 class="text-2xl font-bold text-gray-800">üçΩÔ∏è Nosso Card√°pio</h2>
         <div id="sync-status" class="flex items-center mt-1">
          <div id="connection-dot" class="w-2 h-2 bg-red-500 rounded-full mr-2"></div><span id="connection-text" class="text-xs text-red-600 font-medium">Conectando...</span>
         </div>
        </div><button onclick="requestAdminAccess()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors text-sm"> üë®‚Äçüíº Painel Admin </button>
       </div><!-- Entradas -->
       <div class="category-card bg-gradient-to-r from-yellow-50 to-orange-50 rounded-lg p-6 mb-6 border-l-4 border-yellow-500">
        <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center"><span class="bg-yellow-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm mr-3">ü•ó</span> Entradas</h3>
        <div class="space-y-3">
         <div class="menu-item flex justify-between items-center p-3 rounded-lg border border-yellow-200">
          <div>
           <h4 class="font-medium text-gray-800">Bruschetta Especial</h4>
           <p class="text-sm text-gray-600">P√£o italiano, tomate, manjeric√£o e queijo</p>
          </div>
          <div class="flex items-center space-x-2"><span class="font-bold text-yellow-700">R$ 45</span> <button onclick="addToCart('Bruschetta Especial', 'Entradas', 45)" class="quantity-btn bg-yellow-500 text-white px-3 py-1 rounded-full text-sm hover:bg-yellow-600"> Adicionar </button>
          </div>
         </div>
         <div class="menu-item flex justify-between items-center p-3 rounded-lg border border-yellow-200">
          <div>
           <h4 class="font-medium text-gray-800">Antipasto da Casa</h4>
           <p class="text-sm text-gray-600">Sele√ß√£o de frios, queijos e azeitonas</p>
          </div>
          <div class="flex items-center space-x-2"><span class="font-bold text-yellow-700">R$ 55</span> <button onclick="addToCart('Antipasto da Casa', 'Entradas', 55)" class="quantity-btn bg-yellow-500 text-white px-3 py-1 rounded-full text-sm hover:bg-yellow-600"> Adicionar </button>
          </div>
         </div>
        </div>
       </div><!-- Pizzas -->
       <div class="category-card bg-gradient-to-r from-red-50 to-orange-50 rounded-lg p-6 mb-6 border-l-4 border-red-500">
        <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center"><span class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm mr-3">üçï</span> Pizzas Tradicionais</h3>
        <div class="space-y-3">
         <div class="menu-item flex justify-between items-center p-3 rounded-lg border border-red-200">
          <div>
           <h4 class="font-medium text-gray-800">Margherita</h4>
           <p class="text-sm text-gray-600">Molho de tomate, mussarela e manjeric√£o</p>
          </div>
          <div class="flex items-center space-x-2"><span class="font-bold text-red-700">R$ 75</span> <button onclick="addToCart('Pizza Margherita', 'Pizzas', 75)" class="quantity-btn bg-red-500 text-white px-3 py-1 rounded-full text-sm hover:bg-red-600"> Adicionar </button>
          </div>
         </div>
         <div class="menu-item flex justify-between items-center p-3 rounded-lg border border-red-200">
          <div>
           <h4 class="font-medium text-gray-800">Pepperoni</h4>
           <p class="text-sm text-gray-600">Molho de tomate, mussarela e pepperoni</p>
          </div>
          <div class="flex items-center space-x-2"><span class="font-bold text-red-700">R$ 85</span> <button onclick="addToCart('Pizza Pepperoni', 'Pizzas', 85)" class="quantity-btn bg-red-500 text-white px-3 py-1 rounded-full text-sm hover:bg-red-600"> Adicionar </button>
          </div>
         </div>
         <div class="menu-item flex justify-between items-center p-3 rounded-lg border border-red-200">
          <div>
           <h4 class="font-medium text-gray-800">Quatro Queijos</h4>
           <p class="text-sm text-gray-600">Mussarela, gorgonzola, parmes√£o e provolone</p>
          </div>
          <div class="flex items-center space-x-2"><span class="font-bold text-red-700">R$ 90</span> <button onclick="addToCart('Pizza Quatro Queijos', 'Pizzas', 90)" class="quantity-btn bg-red-500 text-white px-3 py-1 rounded-full text-sm hover:bg-red-600"> Adicionar </button>
          </div>
         </div>
        </div>
       </div><!-- Sobremesas -->
       <div class="category-card bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-6 mb-6 border-l-4 border-purple-500">
        <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center"><span class="bg-purple-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm mr-3">üç∞</span> Sobremesas</h3>
        <div class="space-y-3">
         <div class="menu-item flex justify-between items-center p-3 rounded-lg border border-purple-200">
          <div>
           <h4 class="font-medium text-gray-800">Tiramisu</h4>
           <p class="text-sm text-gray-600">Cl√°ssico italiano com caf√© e mascarpone</p>
          </div>
          <div class="flex items-center space-x-2"><span class="font-bold text-purple-700">R$ 35</span> <button onclick="addToCart('Tiramisu', 'Sobremesas', 35)" class="quantity-btn bg-purple-500 text-white px-3 py-1 rounded-full text-sm hover:bg-purple-600"> Adicionar </button>
          </div>
         </div>
         <div class="menu-item flex justify-between items-center p-3 rounded-lg border border-purple-200">
          <div>
           <h4 class="font-medium text-gray-800">Gelato Artesanal</h4>
           <p class="text-sm text-gray-600">Sabores: baunilha, chocolate ou morango</p>
          </div>
          <div class="flex items-center space-x-2"><span class="font-bold text-purple-700">R$ 30</span> <button onclick="addToCart('Gelato Artesanal', 'Sobremesas', 30)" class="quantity-btn bg-purple-500 text-white px-3 py-1 rounded-full text-sm hover:bg-purple-600"> Adicionar </button>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div><!-- Carrinho -->
     <div class="lg:col-span-1">
      <div class="bg-white rounded-xl shadow-lg p-6 sticky top-4">
       <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center"><span class="bg-orange-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm mr-3">üõí</span> Seu Pedido</h3>
       <div id="cart-items" class="space-y-3 mb-4 min-h-[100px]">
        <p class="text-gray-500 text-center py-8">Seu carrinho est√° vazio</p>
       </div><!-- Dados de Entrega -->
       <div class="border-t pt-4 mb-4">
        <h4 class="text-sm font-medium text-gray-700 mb-3">üìç Dados para Entrega *</h4>
        <div class="space-y-3">
         <div><label for="customer-name" class="block text-xs text-gray-600 mb-1">Nome completo</label> <input type="text" id="customer-name" placeholder="Seu nome completo..." class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-sm">
         </div>
         <div><label for="delivery-address" class="block text-xs text-gray-600 mb-1">Endere√ßo e refer√™ncia</label> <textarea id="delivery-address" placeholder="Rua, n√∫mero, bairro e ponto de refer√™ncia..." class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 resize-none text-sm" rows="2"></textarea>
         </div>
         <div><label for="customer-whatsapp" class="block text-xs text-gray-600 mb-1">WhatsApp</label> <input type="tel" id="customer-whatsapp" placeholder="(11) 99999-9999" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-sm" oninput="formatWhatsApp(this)">
         </div>
        </div>
       </div><!-- Forma de Pagamento -->
       <div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-3"> üí≥ Forma de Pagamento * </label>
        <div class="space-y-2"><label class="flex items-center p-3 border border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer"> <input type="radio" name="payment-method" value="dinheiro" onchange="togglePaymentOptions()" class="text-orange-500 focus:ring-orange-500"> <span class="ml-3 text-sm">üíµ Dinheiro</span> </label> <label class="flex items-center p-3 border border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer"> <input type="radio" name="payment-method" value="pix" onchange="togglePaymentOptions()" class="text-orange-500 focus:ring-orange-500"> <span class="ml-3 text-sm">üì± PIX</span> </label> <label class="flex items-center p-3 border border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer"> <input type="radio" name="payment-method" value="cartao" onchange="togglePaymentOptions()" class="text-orange-500 focus:ring-orange-500"> <span class="ml-3 text-sm">üí≥ Cart√£o (D√©bito/Cr√©dito)</span> </label>
        </div>
        <div class="mt-2 p-2 bg-blue-50 border border-blue-200 rounded text-xs text-blue-700">
         üí° <strong>Cart√£o:</strong> Levamos a maquininha na entrega! Aceita d√©bito e cr√©dito.
        </div>
       </div><!-- Op√ß√µes de Troco -->
       <div id="change-section" class="mb-4 hidden">
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3"><label class="flex items-center mb-2"> <input type="checkbox" id="needs-change" onchange="toggleChangeAmount()" class="text-orange-500 focus:ring-orange-500"> <span class="ml-2 text-sm font-medium">Preciso de troco</span> </label>
         <div id="change-amount-section" class="hidden"><label for="change-amount" class="block text-xs text-gray-600 mb-1"> Valor que voc√™ tem: </label> <input type="number" id="change-amount" step="0.01" min="0" placeholder="Ex: 100.00" class="w-full p-2 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-orange-500">
         </div>
        </div>
       </div>
       <div class="border-t pt-4">
        <div class="flex justify-between items-center mb-4"><span class="font-bold text-lg">Total:</span> <span id="total-price" class="font-bold text-xl text-orange-600">R$ 0,00</span>
        </div><button id="order-button" onclick="finalizeOrder()" class="w-full bg-gradient-to-r from-orange-500 to-red-500 text-white py-3 px-6 rounded-lg font-semibold text-lg hover:from-orange-600 hover:to-red-600 transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none" disabled> Fazer Pedido </button> <button onclick="clearCart()" class="w-full mt-2 bg-gray-200 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-300 transition-colors"> Limpar Carrinho </button>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Modal de Login Admin -->
   <div id="admin-login-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
    <div class="flex items-center justify-center min-h-full p-4">
     <div class="bg-white rounded-xl shadow-2xl max-w-md w-full">
      <div class="bg-gradient-to-r from-gray-700 to-gray-800 text-white p-6 rounded-t-xl">
       <div class="flex justify-between items-center">
        <h2 class="text-xl font-bold">üîê Acesso Administrativo</h2><button onclick="closeAdminLogin()" class="text-white hover:text-gray-300 text-2xl"> ‚úï </button>
       </div>
       <p class="text-gray-300 text-sm mt-2">Digite a senha para acessar o painel</p>
      </div>
      <div class="p-6">
       <div class="mb-4"><label for="admin-password" class="block text-sm font-medium text-gray-700 mb-2"> Senha de Administrador </label> <input type="password" id="admin-password" placeholder="Digite a senha..." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-500 focus:border-gray-500" onkeypress="if(event.key==='Enter') attemptAdminLogin()">
       </div>
       <div id="login-error" class="hidden mb-4 p-3 bg-red-100 border border-red-300 text-red-700 rounded-lg text-sm">
        ‚ùå Senha incorreta. Tente novamente.
       </div>
       <div class="flex space-x-3"><button onclick="closeAdminLogin()" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors"> Cancelar </button> <button onclick="attemptAdminLogin()" class="flex-1 bg-gray-700 text-white py-2 px-4 rounded-lg hover:bg-gray-800 transition-colors"> Entrar </button>
       </div>
       <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
        <p class="text-xs text-blue-700">üí° <strong>Dica:</strong> Esta √°rea √© restrita aos administradores da pizzaria.</p>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Painel Administrativo -->
   <div id="admin-panel" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
    <div class="flex items-center justify-center min-h-full p-4">
     <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
      <div class="bg-gradient-to-r from-gray-700 to-gray-800 text-white p-6">
       <div class="flex justify-between items-center">
        <h2 class="text-2xl font-bold">üìã Painel Administrativo - Pedidos</h2>
        <div class="flex items-center space-x-3">
         <div id="admin-sync-status" class="flex items-center">
          <div id="admin-connection-dot" class="w-2 h-2 bg-red-500 rounded-full mr-2"></div><span id="admin-connection-text" class="text-xs text-red-300">Conectando...</span>
         </div><span class="text-sm text-gray-300"> üë§ Logado como Admin </span> <button onclick="logoutAdmin()" class="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 transition-colors"> üö™ Sair </button> <button onclick="toggleAdminPanel()" class="text-white hover:text-gray-300 text-2xl"> ‚úï </button>
        </div>
       </div>
       <p class="text-gray-300 mt-2">Gerencie todos os pedidos recebidos em tempo real</p>
      </div>
      <div class="p-6 overflow-y-auto max-h-[70vh]">
       <div class="flex justify-between items-center mb-6">
        <div class="flex items-center space-x-4">
         <div class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium"><span id="total-orders">0</span> Pedidos Hoje
         </div>
         <div class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">
          Total: <span id="total-revenue">R$ 0,00</span>
         </div>
         <div class="bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-sm font-medium">
          Pendentes: <span id="pending-orders">0</span>
         </div>
        </div>
        <div class="flex space-x-2"><button onclick="refreshOrders()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors text-sm"> üîÑ Atualizar </button> <button onclick="testSyncNotification()" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition-colors text-sm"> üîî Testar Sync </button> <button onclick="clearAllOrders()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors text-sm"> üóëÔ∏è Limpar Tudo </button>
        </div>
       </div><!-- Abas de navega√ß√£o -->
       <div class="flex border-b border-gray-200 mb-6"><button id="tab-pending" onclick="switchTab('pending')" class="tab-button px-6 py-3 font-medium text-sm border-b-2 border-orange-500 text-orange-600 bg-orange-50"> üïê Pedidos Pendentes (<span id="tab-pending-count">0</span>) </button> <button id="tab-completed" onclick="switchTab('completed')" class="tab-button px-6 py-3 font-medium text-sm border-b-2 border-transparent text-gray-500 hover:text-gray-700"> ‚úÖ Hist√≥rico Completo (<span id="tab-completed-count">0</span>) </button>
       </div>
       <div id="orders-list" class="space-y-4">
        <div class="text-center py-12 text-gray-500">
         <div class="text-6xl mb-4">
          üìù
         </div>
         <p class="text-lg">Nenhum pedido recebido ainda</p>
         <p class="text-sm">Os pedidos aparecer√£o aqui em tempo real</p>
        </div>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Modal PIX -->
   <div id="pix-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
    <div class="flex items-center justify-center min-h-full p-4">
     <div class="bg-white rounded-xl shadow-2xl max-w-md w-full">
      <div class="bg-gradient-to-r from-green-600 to-green-700 text-white p-6 rounded-t-xl">
       <div class="flex justify-between items-center">
        <h2 class="text-xl font-bold">üì± Pagamento PIX</h2><button onclick="closePixModal()" class="text-white hover:text-gray-300 text-2xl"> ‚úï </button>
       </div>
       <p class="text-green-100 text-sm mt-2">Escaneie o QR Code ou copie a chave</p>
      </div>
      <div class="p-6">
       <div class="text-center mb-6">
        <div class="text-2xl font-bold text-gray-800 mb-2">
         Valor: <span id="pix-amount" class="text-green-600">R$ 0,00</span>
        </div>
       </div><!-- QR Code -->
       <div class="bg-white border-2 border-gray-300 rounded-lg p-4 mb-4">
        <div id="qr-code" class="w-48 h-48 mx-auto bg-white border border-gray-200 rounded"><!-- QR Code ser√° gerado aqui -->
        </div>
       </div><!-- Chave PIX -->
       <div class="mb-6"><label class="block text-sm font-medium text-gray-700 mb-2"> Ou copie a chave PIX: </label>
        <div class="flex"><input type="text" id="pix-key" readonly class="flex-1 p-3 border border-gray-300 rounded-l-lg bg-gray-50 text-xs font-mono"> <button onclick="copyPixKey()" class="bg-green-600 text-white px-4 py-3 rounded-r-lg hover:bg-green-700 transition-colors"> üìã Copiar </button>
        </div>
       </div>
       <div class="flex space-x-3"><button onclick="closePixModal()" class="flex-1 bg-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-400 transition-colors"> Cancelar </button> <button onclick="confirmPixPayment()" class="flex-1 bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition-colors"> ‚úÖ Confirmar Pagamento </button>
       </div>
       <div class="mt-4 p-3 bg-green-50 border border-green-200 rounded-lg">
        <p class="text-xs text-green-700">üí° Ap√≥s realizar o pagamento, clique em "Confirmar Pagamento" para finalizar seu pedido.</p>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
        // üåê CONFIGURA√á√ÉO FIREBASE REAL PARA SINCRONIZA√á√ÉO
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyDxYZ123-demo-key-not-real",
            authDomain: "pizzaria-rodrigues-sync.firebaseapp.com",
            databaseURL: "https://pizzaria-rodrigues-sync-default-rtdb.firebaseio.com/",
            projectId: "pizzaria-rodrigues-sync",
            storageBucket: "pizzaria-rodrigues-sync.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:demo123"
        };

        // ‚≠ê CONFIGURA√á√ÉO DA PIZZARIA
        const PIZZARIA_CONFIG = {
            pix_key: "86999049131",
            pix_receiver_name: "Ana M√°rcia Silva Rodrigues",
            pix_city: "Cocal dos Alves, PI",
            admin_password: 'admin123',
            session_duration: 30 * 60 * 1000, // 30 minutos
        };

        // üåê VARI√ÅVEIS DE SINCRONIZA√á√ÉO
        let firebaseApp = null;
        let database = null;
        let isFirebaseConnected = false;
        let ordersRef = null;
        let lastKnownOrderCount = 0;

        // üîä SISTEMA DE NOTIFICA√á√ÉO SONORA
        let audioContext = null;
        
        function createNotificationSound() {
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                const playTone = (frequency, startTime, duration) => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(frequency, startTime);
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0, startTime);
                    gainNode.gain.linearRampToValueAtTime(0.3, startTime + 0.01);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + duration);
                    
                    oscillator.start(startTime);
                    oscillator.stop(startTime + duration);
                };
                
                const currentTime = audioContext.currentTime;
                
                // Sequ√™ncia harm√¥nica: D√≥ - Mi - Sol
                playTone(523.25, currentTime, 0.2);        // D√≥
                playTone(659.25, currentTime + 0.15, 0.2); // Mi  
                playTone(783.99, currentTime + 0.3, 0.3);  // Sol
                
            } catch (error) {
                console.log('√Åudio n√£o dispon√≠vel:', error);
            }
        }
        
        function playNewOrderNotification() {
            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume().then(() => {
                    createNotificationSound();
                });
            } else {
                createNotificationSound();
            }
        }
        
        function initializeAudio() {
            if (!audioContext) {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (error) {
                    console.log('Web Audio API n√£o suportada');
                }
            }
        }

        // üåê INICIALIZA√á√ÉO DO FIREBASE
        async function initializeFirebase() {
            try {
                console.log('üîÑ Inicializando Firebase...');
                updateConnectionStatus('connecting');
                
                // Inicializar Firebase
                if (!firebase.apps.length) {
                    firebaseApp = firebase.initializeApp(FIREBASE_CONFIG);
                } else {
                    firebaseApp = firebase.app();
                }
                
                database = firebase.database();
                ordersRef = database.ref('orders');
                
                // Testar conex√£o
                await database.ref('.info/connected').once('value');
                
                isFirebaseConnected = true;
                updateConnectionStatus('connected');
                
                // Configurar listeners em tempo real
                setupRealtimeListeners();
                
                console.log('‚úÖ Firebase conectado com sucesso!');
                showToast('üì± Sincroniza√ß√£o ativada! Pedidos sincronizados entre dispositivos', 'success');
                
            } catch (error) {
                console.log('‚ùå Erro ao conectar Firebase:', error);
                isFirebaseConnected = false;
                updateConnectionStatus('disconnected');
                
                // Tentar reconectar em 5 segundos
                setTimeout(initializeFirebase, 5000);
            }
        }

        // üîÑ CONFIGURAR LISTENERS EM TEMPO REAL
        function setupRealtimeListeners() {
            if (!ordersRef) return;
            
            // Listener para novos pedidos
            ordersRef.on('child_added', (snapshot) => {
                const orderData = snapshot.val();
                if (orderData && orderData.timestamp) {
                    const orderTime = new Date(orderData.timestamp).getTime();
                    const now = Date.now();
                    
                    // Se o pedido foi criado nos √∫ltimos 10 segundos, √© um novo pedido
                    if (now - orderTime < 10000) {
                        handleNewOrderFromSync(orderData);
                    }
                }
            });
            
            // Listener para mudan√ßas de status
            ordersRef.on('child_changed', (snapshot) => {
                const orderData = snapshot.val();
                if (orderData) {
                    handleOrderStatusChange(orderData);
                }
            });
            
            // Listener para conex√£o
            database.ref('.info/connected').on('value', (snapshot) => {
                if (snapshot.val() === true) {
                    updateConnectionStatus('connected');
                } else {
                    updateConnectionStatus('disconnected');
                }
            });
        }

        // üì± LIDAR COM NOVO PEDIDO SINCRONIZADO
        function handleNewOrderFromSync(orderData) {
            // Verificar se o pedido j√° existe localmente
            const localOrders = JSON.parse(localStorage.getItem('pizzaria_orders') || '[]');
            const existsLocally = localOrders.some(order => order.id === orderData.id);
            
            if (!existsLocally) {
                // Adicionar ao localStorage
                localOrders.push(orderData);
                localStorage.setItem('pizzaria_orders', JSON.stringify(localOrders));
                
                // Atualizar interface
                allOrders = localOrders;
                updateAdminPanel(allOrders);
                
                // üîä NOTIFICA√á√ÉO SONORA + VISUAL
                playNewOrderNotification();
                showNewOrderNotification(orderData);
                
                console.log('üì± Novo pedido sincronizado:', orderData.id);
            }
        }

        // üìä LIDAR COM MUDAN√áA DE STATUS
        function handleOrderStatusChange(orderData) {
            const localOrders = JSON.parse(localStorage.getItem('pizzaria_orders') || '[]');
            const orderIndex = localOrders.findIndex(order => order.id === orderData.id);
            
            if (orderIndex !== -1 && localOrders[orderIndex].status !== orderData.status) {
                localOrders[orderIndex].status = orderData.status;
                localStorage.setItem('pizzaria_orders', JSON.stringify(localOrders));
                
                // Atualizar interface
                allOrders = localOrders;
                updateAdminPanel(allOrders);
                
                // Notificar mudan√ßa
                if (orderData.status === 'completed') {
                    showToast(`‚úÖ Pedido #${orderData.id.split('_')[1].slice(-6)} foi conclu√≠do!`, 'success');
                }
                
                console.log('üìä Status do pedido atualizado:', orderData.id, orderData.status);
            }
        }

        // üîÑ ATUALIZAR STATUS DE CONEX√ÉO
        function updateConnectionStatus(status) {
            const connectionDot = document.getElementById('connection-dot');
            const connectionText = document.getElementById('connection-text');
            const adminConnectionDot = document.getElementById('admin-connection-dot');
            const adminConnectionText = document.getElementById('admin-connection-text');
            
            switch (status) {
                case 'connecting':
                    connectionDot.className = 'w-2 h-2 bg-yellow-500 rounded-full mr-2 animate-pulse';
                    connectionText.textContent = 'Conectando...';
                    connectionText.className = 'text-xs text-yellow-600 font-medium';
                    if (adminConnectionDot) {
                        adminConnectionDot.className = 'w-2 h-2 bg-yellow-500 rounded-full mr-2 animate-pulse';
                        adminConnectionText.textContent = 'Conectando...';
                        adminConnectionText.className = 'text-xs text-yellow-300';
                    }
                    break;
                    
                case 'connected':
                    connectionDot.className = 'w-2 h-2 bg-green-500 rounded-full mr-2 pulse-green';
                    connectionText.textContent = 'Sincronizado entre dispositivos';
                    connectionText.className = 'text-xs text-green-600 font-medium';
                    if (adminConnectionDot) {
                        adminConnectionDot.className = 'w-2 h-2 bg-green-500 rounded-full mr-2 pulse-green';
                        adminConnectionText.textContent = 'Sincronizado';
                        adminConnectionText.className = 'text-xs text-green-300';
                    }
                    break;
                    
                case 'disconnected':
                    connectionDot.className = 'w-2 h-2 bg-red-500 rounded-full mr-2';
                    connectionText.textContent = 'Modo offline';
                    connectionText.className = 'text-xs text-red-600 font-medium';
                    if (adminConnectionDot) {
                        adminConnectionDot.className = 'w-2 h-2 bg-red-500 rounded-full mr-2';
                        adminConnectionText.textContent = 'Offline';
                        adminConnectionText.className = 'text-xs text-red-300';
                    }
                    break;
            }
        }

        // üì§ SINCRONIZAR PEDIDO PARA FIREBASE
        async function syncOrderToFirebase(orderData) {
            if (!isFirebaseConnected || !ordersRef) {
                console.log('Firebase n√£o conectado, salvando apenas localmente');
                return;
            }
            
            try {
                await ordersRef.child(orderData.id).set(orderData);
                console.log('‚úÖ Pedido sincronizado no Firebase:', orderData.id);
            } catch (error) {
                console.log('‚ùå Erro ao sincronizar pedido:', error);
            }
        }

        // üìä SINCRONIZAR STATUS PARA FIREBASE
        async function syncOrderStatusToFirebase(orderData) {
            if (!isFirebaseConnected || !ordersRef) {
                return;
            }
            
            try {
                await ordersRef.child(orderData.id).update({
                    status: orderData.status,
                    updated_at: new Date().toISOString()
                });
                console.log('‚úÖ Status sincronizado no Firebase:', orderData.id, orderData.status);
            } catch (error) {
                console.log('‚ùå Erro ao sincronizar status:', error);
            }
        }

        // üîî MOSTRAR NOTIFICA√á√ÉO DE NOVO PEDIDO
        function showNewOrderNotification(order) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-lg shadow-2xl z-[100] max-w-sm animate-bounce-in';
            notification.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="text-2xl">üîî</div>
                    <div class="flex-1">
                        <h4 class="font-bold text-sm">Novo Pedido Recebido!</h4>
                        <p class="text-xs text-green-100 mt-1">
                            üë§ ${order.customer_name}<br>
                            üí∞ R$ ${order.total.toFixed(2).replace('.', ',')}
                        </p>
                        <p class="text-xs text-green-200 mt-2">
                            üì± Sincronizado entre dispositivos
                        </p>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            class="text-white hover:text-green-200 text-lg">
                        ‚úï
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Remover automaticamente ap√≥s 8 segundos
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 8000);
        }

        // Estado do sistema
        let cart = [];
        let orderCount = 0;
        let currentTab = 'pending';
        let allOrders = [];
        let adminSessionExpiry = null;

        // üîí FUN√á√ïES DE AUTENTICA√á√ÉO ADMIN
        function requestAdminAccess() {
            if (isAdminLoggedIn()) {
                toggleAdminPanel();
            } else {
                showAdminLogin();
            }
        }

        function showAdminLogin() {
            const modal = document.getElementById('admin-login-modal');
            const passwordInput = document.getElementById('admin-password');
            const errorDiv = document.getElementById('login-error');
            
            modal.classList.remove('hidden');
            errorDiv.classList.add('hidden');
            passwordInput.value = '';
            passwordInput.focus();
        }

        function closeAdminLogin() {
            const modal = document.getElementById('admin-login-modal');
            modal.classList.add('hidden');
        }

        function attemptAdminLogin() {
            const passwordInput = document.getElementById('admin-password');
            const errorDiv = document.getElementById('login-error');
            const password = passwordInput.value;

            if (password === PIZZARIA_CONFIG.admin_password) {
                adminSessionExpiry = Date.now() + PIZZARIA_CONFIG.session_duration;
                localStorage.setItem('adminSessionExpiry', adminSessionExpiry.toString());
                
                closeAdminLogin();
                toggleAdminPanel();
                showToast('Login realizado com sucesso! üéâ', 'success');
            } else {
                errorDiv.classList.remove('hidden');
                passwordInput.classList.add('shake');
                passwordInput.value = '';
                passwordInput.focus();
                
                setTimeout(() => {
                    passwordInput.classList.remove('shake');
                }, 500);
            }
        }

        function isAdminLoggedIn() {
            const storedExpiry = localStorage.getItem('adminSessionExpiry');
            if (!storedExpiry) return false;
            
            const expiry = parseInt(storedExpiry);
            if (Date.now() > expiry) {
                localStorage.removeItem('adminSessionExpiry');
                adminSessionExpiry = null;
                return false;
            }
            
            adminSessionExpiry = expiry;
            return true;
        }

        function checkAdminSession() {
            if (adminSessionExpiry && Date.now() > adminSessionExpiry) {
                logoutAdmin();
                showToast('Sess√£o administrativa expirada. Fa√ßa login novamente.', 'error');
            }
        }

        function logoutAdmin() {
            adminSessionExpiry = null;
            localStorage.removeItem('adminSessionExpiry');
            
            const panel = document.getElementById('admin-panel');
            if (!panel.classList.contains('hidden')) {
                panel.classList.add('hidden');
            }
            
            showToast('Logout realizado com sucesso! üëã', 'success');
        }

        // üõí FUN√á√ïES DO CARRINHO
        function addToCart(name, category, price) {
            const existingItem = cart.find(item => item.name === name);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: Date.now().toString(),
                    name: name,
                    category: category,
                    price: price,
                    quantity: 1
                });
            }
            
            updateCartDisplay();
            showToast(`${name} adicionado ao carrinho!`);
        }

        function removeFromCart(itemId) {
            cart = cart.filter(item => item.id !== itemId);
            updateCartDisplay();
        }

        function updateQuantity(itemId, change) {
            const item = cart.find(item => item.id === itemId);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    removeFromCart(itemId);
                } else {
                    updateCartDisplay();
                }
            }
        }

        function updateCartDisplay() {
            const cartItemsElement = document.getElementById('cart-items');
            const totalPriceElement = document.getElementById('total-price');
            const orderButton = document.getElementById('order-button');
            
            if (cart.length === 0) {
                cartItemsElement.innerHTML = '<p class="text-gray-500 text-center py-8">Seu carrinho est√° vazio</p>';
                totalPriceElement.textContent = 'R$ 0,00';
                orderButton.disabled = true;
                return;
            }
            
            // Verificar campos obrigat√≥rios
            const customerName = document.getElementById('customer-name').value.trim();
            const deliveryAddress = document.getElementById('delivery-address').value.trim();
            const customerWhatsapp = document.getElementById('customer-whatsapp').value.trim();
            const paymentMethod = document.querySelector('input[name="payment-method"]:checked');
            
            orderButton.disabled = !customerName || !deliveryAddress || !customerWhatsapp || !paymentMethod;
            
            let total = 0;
            cartItemsElement.innerHTML = cart.map(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                return `
                    <div class="cart-item bg-gray-50 p-3 rounded-lg border">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-medium text-sm">${item.name}</h4>
                            <button onclick="removeFromCart('${item.id}')" 
                                    class="text-red-500 hover:text-red-700 text-xs">
                                ‚úï
                            </button>
                        </div>
                        <div class="flex justify-between items-center">
                            <div class="flex items-center space-x-2">
                                <button onclick="updateQuantity('${item.id}', -1)" 
                                        class="quantity-btn bg-gray-300 text-gray-700 w-6 h-6 rounded-full text-xs hover:bg-gray-400">
                                    -
                                </button>
                                <span class="text-sm font-medium">${item.quantity}</span>
                                <button onclick="updateQuantity('${item.id}', 1)" 
                                        class="quantity-btn bg-orange-500 text-white w-6 h-6 rounded-full text-xs hover:bg-orange-600">
                                    +
                                </button>
                            </div>
                            <span class="font-bold text-sm">R$ ${itemTotal.toFixed(2).replace('.', ',')}</span>
                        </div>
                    </div>
                `;
            }).join('');
            
            totalPriceElement.textContent = `R$ ${total.toFixed(2).replace('.', ',')}`;
        }

        function clearCart() {
            cart = [];
            updateCartDisplay();
            showToast('Carrinho limpo!');
        }

        // üìù FINALIZAR PEDIDO
        async function finalizeOrder() {
            if (cart.length === 0) return;
            
            // Validar campos
            const customerName = document.getElementById('customer-name').value.trim();
            const deliveryAddress = document.getElementById('delivery-address').value.trim();
            const customerWhatsapp = document.getElementById('customer-whatsapp').value.trim();
            const paymentMethod = document.querySelector('input[name="payment-method"]:checked');
            
            if (!customerName) {
                showToast('Por favor, preencha seu nome completo', 'error');
                return;
            }
            
            if (!deliveryAddress) {
                showToast('Por favor, preencha o endere√ßo de entrega', 'error');
                return;
            }
            
            if (!customerWhatsapp) {
                showToast('Por favor, preencha seu WhatsApp', 'error');
                return;
            }
            
            if (!paymentMethod) {
                showToast('Por favor, selecione a forma de pagamento', 'error');
                return;
            }
            
            // Se for PIX, mostrar modal
            if (paymentMethod.value === 'pix') {
                showPixModal();
                return;
            }
            
            // Processar pedido
            await processOrder();
        }
        
        async function processOrder() {
            const orderButton = document.getElementById('order-button');
            const originalText = orderButton.textContent;
            
            orderButton.disabled = true;
            orderButton.textContent = 'Processando...';
            
            try {
                // Coletar dados
                const customerName = document.getElementById('customer-name').value.trim();
                const deliveryAddress = document.getElementById('delivery-address').value.trim();
                const customerWhatsapp = document.getElementById('customer-whatsapp').value.trim();
                const paymentMethod = document.querySelector('input[name="payment-method"]:checked').value;
                const needsChange = document.getElementById('needs-change').checked;
                const changeAmount = parseFloat(document.getElementById('change-amount').value) || 0;
                
                const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const changeDue = needsChange && changeAmount > total ? changeAmount - total : 0;
                
                // Criar pedido
                const orderId = `order_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                
                const orderData = {
                    id: orderId,
                    items: cart.map(item => ({
                        name: item.name,
                        category: item.category,
                        price: item.price,
                        quantity: item.quantity
                    })),
                    customer_name: customerName,
                    delivery_address: deliveryAddress,
                    customer_whatsapp: customerWhatsapp,
                    payment_method: paymentMethod,
                    needs_change: needsChange,
                    change_amount: changeAmount,
                    change_due: changeDue,
                    timestamp: new Date().toISOString(),
                    status: 'pending',
                    total: total
                };
                
                // Salvar localmente
                const existingOrders = JSON.parse(localStorage.getItem('pizzaria_orders') || '[]');
                existingOrders.push(orderData);
                localStorage.setItem('pizzaria_orders', JSON.stringify(existingOrders));
                
                // üåê SINCRONIZAR NO FIREBASE
                await syncOrderToFirebase(orderData);
                
                // üîä NOTIFICA√á√ÉO SONORA
                playNewOrderNotification();
                
                // Atualizar interface
                allOrders = existingOrders;
                updateAdminPanel(allOrders);
                
                // Mostrar confirma√ß√£o
                showOrderConfirmationModal(customerName, orderId, total);
                
                // Limpar formul√°rio
                cart = [];
                document.getElementById('customer-name').value = '';
                document.getElementById('delivery-address').value = '';
                document.getElementById('customer-whatsapp').value = '';
                document.querySelectorAll('input[name="payment-method"]').forEach(radio => radio.checked = false);
                document.getElementById('needs-change').checked = false;
                document.getElementById('change-amount').value = '';
                togglePaymentOptions();
                updateCartDisplay();
                
            } catch (error) {
                showToast('Erro ao processar pedido. Tente novamente.', 'error');
            } finally {
                orderButton.disabled = false;
                orderButton.textContent = originalText;
            }
        }

        function showOrderConfirmationModal(customerName, orderId, total) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-2xl max-w-md w-full animate-bounce-in">
                    <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-t-xl text-center">
                        <div class="text-6xl mb-4">üéâ</div>
                        <h2 class="text-2xl font-bold">Pedido Confirmado!</h2>
                        <p class="text-green-100 text-sm mt-2">Seu pedido foi recebido com sucesso</p>
                    </div>
                    
                    <div class="p-6 text-center">
                        <div class="mb-6">
                            <h3 class="text-xl font-bold text-gray-800 mb-2">Ol√°, ${customerName}! üëã</h3>
                            <div class="bg-gray-50 rounded-lg p-4 mb-4">
                                <p class="text-sm text-gray-600 mb-2">üìã <strong>N√∫mero do Pedido:</strong></p>
                                <p class="text-lg font-bold text-orange-600">#${orderId.split('_')[1].slice(-6)}</p>
                            </div>
                            <div class="bg-green-50 rounded-lg p-4 mb-4">
                                <p class="text-sm text-gray-600 mb-2">üí∞ <strong>Valor Total:</strong></p>
                                <p class="text-2xl font-bold text-green-600">R$ ${total.toFixed(2).replace('.', ',')}</p>
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                            <div class="text-blue-600 text-4xl mb-2">üöö</div>
                            <p class="text-blue-800 font-medium">Tempo estimado de entrega:</p>
                            <p class="text-blue-600 text-lg font-bold">30 - 45 minutos</p>
                            <p class="text-blue-600 text-sm mt-2">Em breve nosso entregador estar√° a caminho!</p>
                        </div>
                        
                        <button onclick="closeConfirmationModal()" 
                                class="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-3 px-6 rounded-lg font-semibold text-lg hover:from-green-600 hover:to-green-700 transition-all duration-200 transform hover:scale-105">
                            ‚úÖ Entendi, Obrigado!
                        </button>
                        
                        <div class="mt-4 p-3 bg-orange-50 border border-orange-200 rounded-lg">
                            <p class="text-xs text-orange-700">
                                üçï <strong>Pizzaria Rodrigues</strong> - Obrigado por escolher nosso sabor aut√™ntico!
                            </p>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function closeConfirmationModal() {
            const modals = document.querySelectorAll('.fixed.z-50');
            modals.forEach(modal => {
                if (modal.querySelector('button[onclick="closeConfirmationModal()"]')) {
                    modal.remove();
                }
            });
        }

        // üìã FUN√á√ïES DO PAINEL ADMIN
        function toggleAdminPanel() {
            if (!isAdminLoggedIn()) {
                showAdminLogin();
                return;
            }
            
            const panel = document.getElementById('admin-panel');
            if (panel.classList.contains('hidden')) {
                panel.classList.remove('hidden');
                refreshOrders();
            } else {
                panel.classList.add('hidden');
            }
        }

        function switchTab(tab) {
            currentTab = tab;
            
            const pendingTab = document.getElementById('tab-pending');
            const completedTab = document.getElementById('tab-completed');
            
            if (tab === 'pending') {
                pendingTab.className = 'tab-button px-6 py-3 font-medium text-sm border-b-2 border-orange-500 text-orange-600 bg-orange-50';
                completedTab.className = 'tab-button px-6 py-3 font-medium text-sm border-b-2 border-transparent text-gray-500 hover:text-gray-700';
            } else {
                pendingTab.className = 'tab-button px-6 py-3 font-medium text-sm border-b-2 border-transparent text-gray-500 hover:text-gray-700';
                completedTab.className = 'tab-button px-6 py-3 font-medium text-sm border-b-2 border-green-500 text-green-600 bg-green-50';
            }
            
            updateAdminPanel(allOrders);
        }

        async function refreshOrders() {
            allOrders = JSON.parse(localStorage.getItem('pizzaria_orders') || '[]');
            updateAdminPanel(allOrders);
        }

        function updateAdminPanel(orders) {
            const ordersList = document.getElementById('orders-list');
            const totalOrdersElement = document.getElementById('total-orders');
            const totalRevenueElement = document.getElementById('total-revenue');
            const pendingOrdersElement = document.getElementById('pending-orders');
            const tabPendingCount = document.getElementById('tab-pending-count');
            const tabCompletedCount = document.getElementById('tab-completed-count');
            
            if (!orders || orders.length === 0) {
                ordersList.innerHTML = `
                    <div class="text-center py-12 text-gray-500">
                        <div class="text-6xl mb-4">üìù</div>
                        <p class="text-lg">Nenhum pedido recebido ainda</p>
                        <p class="text-sm">Os pedidos aparecer√£o aqui em tempo real</p>
                    </div>
                `;
                totalOrdersElement.textContent = '0';
                totalRevenueElement.textContent = 'R$ 0,00';
                pendingOrdersElement.textContent = '0';
                tabPendingCount.textContent = '0';
                tabCompletedCount.textContent = '0';
                return;
            }

            const pendingOrders = orders.filter(order => order.status === 'pending');
            const completedOrders = orders.filter(order => order.status === 'completed');
            const ordersToShow = currentTab === 'pending' ? pendingOrders : completedOrders;

            const totalRevenue = orders.reduce((sum, order) => sum + order.total, 0);
            
            totalOrdersElement.textContent = orders.length;
            totalRevenueElement.textContent = `R$ ${totalRevenue.toFixed(2).replace('.', ',')}`;
            pendingOrdersElement.textContent = pendingOrders.length;
            tabPendingCount.textContent = pendingOrders.length;
            tabCompletedCount.textContent = completedOrders.length;

            if (ordersToShow.length === 0) {
                const emptyMessage = currentTab === 'pending' 
                    ? { icon: 'üïê', title: 'Nenhum pedido pendente', subtitle: 'Todos os pedidos foram conclu√≠dos!' }
                    : { icon: '‚úÖ', title: 'Nenhum pedido no hist√≥rico', subtitle: 'Pedidos conclu√≠dos aparecer√£o aqui' };
                    
                ordersList.innerHTML = `
                    <div class="text-center py-12 text-gray-500">
                        <div class="text-6xl mb-4">${emptyMessage.icon}</div>
                        <p class="text-lg">${emptyMessage.title}</p>
                        <p class="text-sm">${emptyMessage.subtitle}</p>
                    </div>
                `;
                return;
            }

            ordersList.innerHTML = ordersToShow
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                .map(order => {
                    const orderTime = new Date(order.timestamp).toLocaleString('pt-BR');
                    const orderId = order.id.split('_')[1];
                    const isCompleted = order.status === 'completed';
                    
                    return `
                        <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <h3 class="font-bold text-lg text-gray-800">Pedido #${orderId.slice(-6)}</h3>
                                    <p class="text-sm text-gray-600">üìÖ ${orderTime}</p>
                                </div>
                                <div class="text-right">
                                    <div class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-bold">
                                        R$ ${order.total.toFixed(2).replace('.', ',')}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="space-y-2">
                                ${order.items.map(item => `
                                    <div class="flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0">
                                        <div class="flex-1">
                                            <span class="font-medium">${item.name}</span>
                                            <span class="text-sm text-gray-500 ml-2">(${item.category})</span>
                                        </div>
                                        <div class="text-right">
                                            <span class="text-sm text-gray-600">${item.quantity}x R$ ${item.price.toFixed(2).replace('.', ',')}</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div class="mt-4 p-3 bg-gray-50 rounded-lg">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                                    <div>
                                        <span class="font-medium text-gray-700">üë§ Cliente:</span>
                                        <p class="text-gray-600 mt-1">${order.customer_name || 'N√£o informado'}</p>
                                        <span class="font-medium text-gray-700">üì± WhatsApp:</span>
                                        <p class="text-gray-600 mt-1">${order.customer_whatsapp || 'N√£o informado'}</p>
                                    </div>
                                    <div>
                                        <span class="font-medium text-gray-700">üìç Endere√ßo:</span>
                                        <p class="text-gray-600 mt-1">${order.delivery_address || 'N√£o informado'}</p>
                                    </div>
                                </div>
                                <div class="mt-3 pt-3 border-t border-gray-200">
                                    <span class="font-medium text-gray-700">üí≥ Pagamento:</span>
                                    <p class="text-gray-600 mt-1">
                                        ${order.payment_method === 'pix' ? 'üì± PIX' : 
                                          order.payment_method === 'cartao' ? 'üí≥ Cart√£o (D√©bito/Cr√©dito)' : 'üíµ Dinheiro'}
                                        ${order.payment_method === 'dinheiro' && order.needs_change ? 
                                            `<br><span class="text-xs text-orange-600">Troco para R$ ${order.change_amount?.toFixed(2).replace('.', ',')} = R$ ${order.change_due?.toFixed(2).replace('.', ',')}</span>` 
                                            : ''}
                                        ${order.payment_method === 'cartao' ? 
                                            `<br><span class="text-xs text-blue-600">üè™ Maquininha ser√° levada na entrega</span>` 
                                            : ''}
                                    </p>
                                </div>
                            </div>
                            
                            <div class="mt-3 pt-3 border-t border-gray-200 flex justify-between items-center">
                                <div class="flex space-x-2">
                                    ${isCompleted 
                                        ? '<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">‚úÖ Conclu√≠do</span>'
                                        : '<span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs">üïê Pendente</span>'
                                    }
                                </div>
                                ${!isCompleted 
                                    ? `<button onclick="markOrderComplete('${orderId}')" 
                                              class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600 transition-colors">
                                          ‚úÖ Concluir
                                      </button>`
                                    : '<span class="text-sm text-gray-500">Pedido finalizado</span>'
                                }
                            </div>
                        </div>
                    `;
                }).join('');
        }

        async function markOrderComplete(orderId) {
            try {
                const orders = JSON.parse(localStorage.getItem('pizzaria_orders') || '[]');
                const orderIndex = orders.findIndex(order => order.id.includes(orderId));
                
                if (orderIndex !== -1) {
                    orders[orderIndex].status = 'completed';
                    localStorage.setItem('pizzaria_orders', JSON.stringify(orders));
                    
                    // üåê SINCRONIZAR STATUS NO FIREBASE
                    await syncOrderStatusToFirebase(orders[orderIndex]);
                    
                    allOrders = orders;
                    updateAdminPanel(allOrders);
                    
                    showToast('Pedido marcado como conclu√≠do! üéâ', 'success');
                }
                
            } catch (error) {
                showToast('Erro ao concluir pedido. Tente novamente.', 'error');
            }
        }

        async function clearAllOrders() {
            const confirmDiv = document.createElement('div');
            confirmDiv.className = 'fixed inset-0 bg-black bg-opacity-50 z-[60] flex items-center justify-center';
            confirmDiv.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-md mx-4">
                    <h3 class="text-lg font-bold mb-4">‚ö†Ô∏è Confirmar Exclus√£o</h3>
                    <p class="text-gray-600 mb-6">Tem certeza que deseja excluir TODOS os pedidos? Esta a√ß√£o n√£o pode ser desfeita.</p>
                    <div class="flex space-x-3">
                        <button onclick="this.closest('.fixed').remove()" 
                                class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded hover:bg-gray-400">
                            Cancelar
                        </button>
                        <button onclick="confirmClearOrders()" 
                                class="flex-1 bg-red-500 text-white py-2 px-4 rounded hover:bg-red-600">
                            Excluir Tudo
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmDiv);
        }

        async function confirmClearOrders() {
            document.querySelector('.fixed.z-\\[60\\]').remove();
            
            // Limpar localStorage
            localStorage.removeItem('pizzaria_orders');
            allOrders = [];
            
            // üåê LIMPAR FIREBASE
            if (isFirebaseConnected && ordersRef) {
                try {
                    await ordersRef.remove();
                    console.log('‚úÖ Pedidos removidos do Firebase');
                } catch (error) {
                    console.log('‚ùå Erro ao limpar Firebase:', error);
                }
            }
            
            showToast('Todos os pedidos foram removidos', 'success');
            updateAdminPanel([]);
            orderCount = 0;
        }

        async function testSyncNotification() {
            const testOrder = {
                id: `order_${Date.now()}_test_sync`,
                items: [
                    {
                        name: 'Pizza Margherita (TESTE)',
                        category: 'Pizzas',
                        price: 75,
                        quantity: 1
                    }
                ],
                customer_name: 'Cliente Teste Sync',
                delivery_address: 'Endere√ßo de teste para sincroniza√ß√£o',
                customer_whatsapp: '(86) 99999-9999',
                payment_method: 'pix',
                needs_change: false,
                change_amount: 0,
                change_due: 0,
                timestamp: new Date().toISOString(),
                status: 'pending',
                total: 75
            };

            // Adicionar localmente
            const localOrders = JSON.parse(localStorage.getItem('pizzaria_orders') || '[]');
            localOrders.push(testOrder);
            localStorage.setItem('pizzaria_orders', JSON.stringify(localOrders));

            // üåê SINCRONIZAR NO FIREBASE
            await syncOrderToFirebase(testOrder);

            // Simular notifica√ß√£o
            playNewOrderNotification();
            showNewOrderNotification(testOrder);

            // Atualizar interface
            allOrders = localOrders;
            updateAdminPanel(allOrders);

            showToast('üß™ Teste de sincroniza√ß√£o executado! Verifique as notifica√ß√µes.', 'info');
        }

        // üí≥ FUN√á√ïES DE PAGAMENTO
        function togglePaymentOptions() {
            const paymentMethod = document.querySelector('input[name="payment-method"]:checked');
            const changeSection = document.getElementById('change-section');
            
            if (paymentMethod && paymentMethod.value === 'dinheiro') {
                changeSection.classList.remove('hidden');
            } else {
                changeSection.classList.add('hidden');
                document.getElementById('needs-change').checked = false;
                toggleChangeAmount();
            }
            
            updateCartDisplay();
        }
        
        function toggleChangeAmount() {
            const needsChange = document.getElementById('needs-change').checked;
            const changeAmountSection = document.getElementById('change-amount-section');
            
            if (needsChange) {
                changeAmountSection.classList.remove('hidden');
            } else {
                changeAmountSection.classList.add('hidden');
                document.getElementById('change-amount').value = '';
            }
        }
        
        // üì± FUN√á√ïES DO PIX
        function showPixModal() {
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const pixModal = document.getElementById('pix-modal');
            const pixAmount = document.getElementById('pix-amount');
            
            pixAmount.textContent = `R$ ${total.toFixed(2).replace('.', ',')}`;
            generatePixQRCode(total);
            pixModal.classList.remove('hidden');
        }
        
        function closePixModal() {
            const pixModal = document.getElementById('pix-modal');
            pixModal.classList.add('hidden');
        }
        
        function generatePixQRCode(amount) {
            const qrCodeContainer = document.getElementById('qr-code');
            const pixKeyInput = document.getElementById('pix-key');
            
            const pixData = {
                chavePix: PIZZARIA_CONFIG.pix_key,
                valor: amount.toFixed(2),
                nomeRecebedor: PIZZARIA_CONFIG.pix_receiver_name,
                cidade: PIZZARIA_CONFIG.pix_city
            };
            
            const pixString = generatePixEMVString(pixData);
            pixKeyInput.value = pixData.chavePix;
            generateRealQRCode(pixString, qrCodeContainer);
        }
        
        function generatePixEMVString(pixData) {
            function formatEMVField(id, value) {
                const length = value.length.toString().padStart(2, '0');
                return id + length + value;
            }
            
            function calculateCRC16(data) {
                let crc = 0xFFFF;
                for (let i = 0; i < data.length; i++) {
                    crc ^= data.charCodeAt(i) << 8;
                    for (let j = 0; j < 8; j++) {
                        if (crc & 0x8000) {
                            crc = (crc << 1) ^ 0x1021;
                        } else {
                            crc = crc << 1;
                        }
                        crc &= 0xFFFF;
                    }
                }
                return crc.toString(16).toUpperCase().padStart(4, '0');
            }
            
            let emvString = '';
            
            emvString += formatEMVField('00', '01');
            emvString += formatEMVField('01', '12');
            
            const pixKey = pixData.chavePix;
            const merchantInfo = formatEMVField('00', 'BR.GOV.BCB.PIX') + formatEMVField('01', pixKey);
            emvString += formatEMVField('26', merchantInfo);
            
            emvString += formatEMVField('52', '0000');
            emvString += formatEMVField('53', '986');
            emvString += formatEMVField('54', pixData.valor);
            emvString += formatEMVField('58', 'BR');
            
            const merchantName = pixData.nomeRecebedor.substring(0, 25);
            emvString += formatEMVField('59', merchantName);
            
            const merchantCity = pixData.cidade.substring(0, 15);
            emvString += formatEMVField('60', merchantCity);
            
            const additionalData = formatEMVField('05', '***');
            emvString += formatEMVField('62', additionalData);
            
            emvString += '6304';
            
            const crc = calculateCRC16(emvString);
            emvString = emvString.substring(0, emvString.length - 4) + '63' + '04' + crc;
            
            return emvString;
        }
        
        function generateRealQRCode(pixString, container) {
            const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(pixString)}&format=png&margin=10`;
            
            container.innerHTML = `
                <div class="flex items-center justify-center w-full h-full">
                    <img src="${qrCodeUrl}" 
                         alt="QR Code PIX" 
                         class="max-w-full max-h-full object-contain rounded border"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"
                         onload="this.nextElementSibling.style.display='none';">
                    <div class="text-center text-gray-500 text-sm" style="display: none;">
                        <div class="text-4xl mb-2">üì±</div>
                        <p>QR Code PIX</p>
                        <p class="text-xs mt-1">Use a chave PIX abaixo</p>
                    </div>
                </div>
            `;
        }
        
        function copyPixKey() {
            const pixKeyInput = document.getElementById('pix-key');
            pixKeyInput.select();
            pixKeyInput.setSelectionRange(0, 99999);
            
            try {
                document.execCommand('copy');
                showToast('Chave PIX copiada! üìã', 'success');
            } catch (err) {
                showToast('Erro ao copiar. Selecione e copie manualmente.', 'error');
            }
        }
        
        async function confirmPixPayment() {
            closePixModal();
            await processOrder();
        }
        
        // üì± FORMATA√á√ÉO DE WHATSAPP
        function formatWhatsApp(input) {
            let value = input.value.replace(/\D/g, '');
            
            if (value.length <= 11) {
                value = value.replace(/^(\d{2})(\d{5})(\d{4})$/, '($1) $2-$3');
                value = value.replace(/^(\d{2})(\d{4})$/, '($1) $2');
                value = value.replace(/^(\d{2})$/, '($1');
            }
            
            input.value = value;
        }

        // üîî MOSTRAR TOAST
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-orange-500';
            
            toast.className = `toast ${bgColor} text-white px-4 py-2 rounded-lg shadow-lg`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // üé® CONFIGURA√á√ÉO DO ELEMENTS SDK
        const defaultConfig = {
            pizzaria_name: "Pizzaria Rodrigues",
            welcome_message: "Bem-vindos ao sabor aut√™ntico da nossa cozinha!"
        };

        async function onConfigChange(config) {
            const pizzariaTitle = document.getElementById('pizzaria-title');
            const welcomeMessage = document.getElementById('welcome-message');
            
            if (pizzariaTitle) {
                pizzariaTitle.textContent = `üçï ${config.pizzaria_name || defaultConfig.pizzaria_name}`;
            }
            
            if (welcomeMessage) {
                welcomeMessage.textContent = config.welcome_message || defaultConfig.welcome_message;
            }
        }

        function mapToCapabilities(config) {
            return {
                recolorables: [],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            };
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ["pizzaria_name", config.pizzaria_name || defaultConfig.pizzaria_name],
                ["welcome_message", config.welcome_message || defaultConfig.welcome_message]
            ]);
        }

        // üöÄ INICIALIZA√á√ÉO
        async function initializeApp() {
            // Verificar sess√£o admin
            checkAdminSession();
            
            // Carregar pedidos existentes
            allOrders = JSON.parse(localStorage.getItem('pizzaria_orders') || '[]');
            
            // üåê INICIALIZAR FIREBASE
            await initializeFirebase();
            
            // Inicializar √°udio
            document.addEventListener('click', initializeAudio, { once: true });
            document.addEventListener('touchstart', initializeAudio, { once: true });
            
            // üé® INICIALIZAR ELEMENTS SDK
            if (window.elementSdk) {
                await window.elementSdk.init({
                    defaultConfig,
                    onConfigChange,
                    mapToCapabilities,
                    mapToEditPanelValues
                });
            }
        }

        // Verificar sess√£o periodicamente
        setInterval(checkAdminSession, 60000);
        
        // Listeners para valida√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            
            const customerName = document.getElementById('customer-name');
            const deliveryAddress = document.getElementById('delivery-address');
            const customerWhatsapp = document.getElementById('customer-whatsapp');
            
            if (customerName) customerName.addEventListener('input', updateCartDisplay);
            if (deliveryAddress) deliveryAddress.addEventListener('input', updateCartDisplay);
            if (customerWhatsapp) customerWhatsapp.addEventListener('input', updateCartDisplay);
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'995c2e9b1415ba13',t:'MTc2MTY3Mjg0Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
